{% extends "base.html" %}
{% block title %}Conversation History{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/conversation_history.css') }}">
{% endblock %}

{% block content %}
    <div class="header">
        <h1 class="mt-4">Conversation History</h1>
        <p>View the history of conversations between users and the chatbot or voicebot.</p>
    </div>

<div>
    <form method="get" id="filterForm">
        <!-- Table Selection Dropdown -->
        <label for="tableSelect">Select Table:</label>
        <select id="tableSelect" name="table" onchange="this.form.submit()">
            <option value="chatbot_results" {% if table == 'chatbot_results' %} selected {% endif %}>Chatbot Results</option>
            <option value="voicebot_results" {% if table == 'voicebot_results' %} selected {% endif %}>Voicebot Results</option>
        </select>

        <!-- Sort by Date Dropdown -->
        <label for="sortBy">Sort By:</label>
        <select id="sortBy" name="sortBy" onchange="this.form.submit()">
            <option value="date_desc" {% if sort_order == 'date_desc' %} selected {% endif %}>Date (Newest First)</option>
            <option value="date_asc" {% if sort_order == 'date_asc' %} selected {% endif %}>Date (Oldest First)</option>
        </select>

        <!-- Rows Per Page Dropdown -->
        <label for="rowsPerPage">Rows per page:</label>
        <select id="rowsPerPage" name="rowsPerPage" onchange="this.form.submit()">
            <option value="10" {% if rows_per_page == 10 %} selected {% endif %}>10</option>
            <option value="25" {% if rows_per_page == 25 %} selected {% endif %}>25</option>
            <option value="50" {% if rows_per_page == 50 %} selected {% endif %}>50</option>
        </select>
    </form>
</div>

<!-- Table with scrollable content -->
<div class="history_table_div">
    <table>
        <thead>
            <tr>
                <th> Query ID </th>
                <th> Recognized Intent Tag</th>
                <th> Confidence Score </th>
                <th> Received Query</th>
                <th> Bot Response </th>
                <th> Response Time </th>
                <th> Query Time </th>
                <th> Query Date </th>
            </tr>
        </thead>
        <tbody>
            {% for row in conversations %}
                <tr>
                    <td>{{ row.query_id }}</td>
                    <td>{{ row.intent_recognized }}</td>
                    <td>{{ row.confidence_score }}</td>
                    <td>{{ row.received_text }}</td>
                    <td>{{ row.bot_response }}</td>
                    <td>{{ row.response_time }}</td>
                    <td>{{ row.query_time }}</td>
                    <td>{{ row.query_date }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination Controls -->
<div class="pagination">
    {% if current_page > 1 %}
        <a href="?page={{ current_page - 1 }}&table={{ table }}&sortBy={{ sort_order }}&rowsPerPage={{ rows_per_page }}">Previous</a>
    {% endif %}
    <span>Page {{ current_page }} of {{ total_pages }}</span>
    {% if current_page < total_pages %}
        <a href="?page={{ current_page + 1 }}&table={{ table }}&sortBy={{ sort_order }}&rowsPerPage={{ rows_per_page }}">Next</a>
    {% endif %}
</div>

{% endblock %}